-- Add SET search_path security setting to all functions
-- This prevents search_path manipulation attacks by ensuring functions use a fixed search_path

-- Note: Using SET search_path = '' requires fully qualified names (e.g., public.table_name)
-- All functions already use fully qualified names, so this is safe

ALTER FUNCTION public.handle_new_user SET search_path = '';
ALTER FUNCTION public.watch_ad_speed_up SET search_path = '';
ALTER FUNCTION public.seed_farm_plots_for_profile SET search_path = '';
ALTER FUNCTION public.seed_armory_for_profile SET search_path = '';
ALTER FUNCTION public.get_factory_slot_cost SET search_path = '';
ALTER FUNCTION public.get_enclosure_cost SET search_path = '';
ALTER FUNCTION public.get_animal_level_from_item_id SET search_path = '';
ALTER FUNCTION public.get_animal_type_id_from_item_id SET search_path = '';
ALTER FUNCTION public.register_push_subscription SET search_path = '';
ALTER FUNCTION public.apply_factory_speed_up SET search_path = '';
ALTER FUNCTION public.seed_factories_for_profile SET search_path = '';
ALTER FUNCTION public.update_coven_member_count SET search_path = '';
ALTER FUNCTION public.seed_starting_inventory_for_profile SET search_path = '';
ALTER FUNCTION public.expand_town SET search_path = '';
ALTER FUNCTION public.buy_seed SET search_path = '';
ALTER FUNCTION public.generate_skyport_orders SET search_path = '';
ALTER FUNCTION public.submit_regatta_task SET search_path = '';
ALTER FUNCTION public.fulfill_skyport_order SET search_path = '';
ALTER FUNCTION public.join_regatta SET search_path = '';
ALTER FUNCTION public.plant_crop SET search_path = '';
ALTER FUNCTION public.move_building SET search_path = '';
ALTER FUNCTION public.get_expansion_cost SET search_path = '';
ALTER FUNCTION public.remove_building SET search_path = '';
ALTER FUNCTION public.get_storage_capacity SET search_path = '';
ALTER FUNCTION public.upgrade_warehouse SET search_path = '';
ALTER FUNCTION public.get_storage_usage SET search_path = '';
ALTER FUNCTION public.grant_xp SET search_path = '';
ALTER FUNCTION public.get_next_enclosure_cost SET search_path = '';
ALTER FUNCTION public.claim_achievement SET search_path = '';
ALTER FUNCTION public.check_achievements_on_harvest SET search_path = '';
ALTER FUNCTION public.get_regatta_leaderboard SET search_path = '';
ALTER FUNCTION public.claim_regatta_rewards SET search_path = '';
ALTER FUNCTION public.calculate_population SET search_path = '';
ALTER FUNCTION public.start_quest SET search_path = '';
ALTER FUNCTION public.update_quest_progress SET search_path = '';
ALTER FUNCTION public.claim_quest_reward SET search_path = '';
ALTER FUNCTION public.generate_daily_quests SET search_path = '';
ALTER FUNCTION public.initialize_mining SET search_path = '';
ALTER FUNCTION public.reset_mining_energy SET search_path = '';
ALTER FUNCTION public.get_dig_energy_cost SET search_path = '';
ALTER FUNCTION public.get_ore_drop SET search_path = '';
ALTER FUNCTION public.repair_tool SET search_path = '';
ALTER FUNCTION public.upgrade_mining_tool SET search_path = '';
ALTER FUNCTION public.create_weekly_regatta SET search_path = '';
ALTER FUNCTION public.mine_ore SET search_path = '';
ALTER FUNCTION public.is_coven_member SET search_path = '';
ALTER FUNCTION public.create_coven_task SET search_path = '';
ALTER FUNCTION public.contribute_to_task SET search_path = '';
ALTER FUNCTION public.claim_coven_task_rewards SET search_path = '';
ALTER FUNCTION public.auto_contribute_coven_tasks SET search_path = '';
ALTER FUNCTION public.create_listing SET search_path = '';
ALTER FUNCTION public.cancel_listing SET search_path = '';
ALTER FUNCTION public.send_friend_request SET search_path = '';
ALTER FUNCTION public.accept_friend_request SET search_path = '';
ALTER FUNCTION public.remove_friend SET search_path = '';
ALTER FUNCTION public.help_friend_speed_production SET search_path = '';
ALTER FUNCTION public.help_friend_fill_order SET search_path = '';
ALTER FUNCTION public.visit_friend_town SET search_path = '';
ALTER FUNCTION public.apply_crop_speed_up SET search_path = '';
ALTER FUNCTION public.get_active_boost_multiplier SET search_path = '';
ALTER FUNCTION public.purchase_premium_item SET search_path = '';
ALTER FUNCTION public.award_aether SET search_path = '';
ALTER FUNCTION public.update_notification_preferences SET search_path = '';
ALTER FUNCTION public.get_player_subscriptions SET search_path = '';
ALTER FUNCTION public.check_achievements SET search_path = '';
ALTER FUNCTION public.get_item_xp SET search_path = '';
ALTER FUNCTION public.check_and_level_up SET search_path = '';
ALTER FUNCTION public.transfer_coven_leadership SET search_path = '';
ALTER FUNCTION public.disband_coven SET search_path = '';
ALTER FUNCTION public.invite_to_coven SET search_path = '';
ALTER FUNCTION public.auto_delete_empty_coven SET search_path = '';
ALTER FUNCTION public.update_member_last_active SET search_path = '';
ALTER FUNCTION public.collect_animal_production SET search_path = '';
ALTER FUNCTION public.start_breeding SET search_path = '';
ALTER FUNCTION public.collect_bred_animal SET search_path = '';
ALTER FUNCTION public.purchase_listing SET search_path = '';
ALTER FUNCTION public.add_animal_to_enclosure SET search_path = '';
ALTER FUNCTION public.purchase_factory_slot SET search_path = '';
ALTER FUNCTION public.get_factory_slot_info SET search_path = '';
ALTER FUNCTION public.start_factory_production SET search_path = '';
-- can_watch_ad has two overloads - need to specify both signatures
ALTER FUNCTION public.can_watch_ad() SET search_path = '';
ALTER FUNCTION public.can_watch_ad(TEXT) SET search_path = '';
ALTER FUNCTION public.harvest_plot SET search_path = '';
ALTER FUNCTION public.collect_factory SET search_path = '';
ALTER FUNCTION public.sell_item SET search_path = '';
ALTER FUNCTION public.place_decoration SET search_path = '';
ALTER FUNCTION public.remove_decoration SET search_path = '';
ALTER FUNCTION public.place_building SET search_path = '';
ALTER FUNCTION public.get_available_buildings SET search_path = '';
ALTER FUNCTION public.claim_daily_reward SET search_path = '';
ALTER FUNCTION public.upgrade_building SET search_path = '';
ALTER FUNCTION public.upgrade_factory SET search_path = '';
ALTER FUNCTION public.place_animal_from_inventory SET search_path = '';
ALTER FUNCTION public.watch_ad_restore_energy SET search_path = '';
ALTER FUNCTION public.plant_plot SET search_path = '';
ALTER FUNCTION public.start_armory_craft SET search_path = '';
ALTER FUNCTION public.collect_armory SET search_path = '';
ALTER FUNCTION public.upgrade_armory SET search_path = '';
ALTER FUNCTION public.create_enclosure SET search_path = '';

